<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kaptanın Spotify</title>

<style>

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: Arial, sans-serif;
}

body {
  background: #000;
  color: white;
  display: flex;
  height: 100vh;
  overflow: hidden;
}

/* ------------------------- */
/*        SIDEBAR            */
/* ------------------------- */

.sidebar {
  width: 240px;
  background: #000;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 25px;
  border-right: 1px solid #111;
}

.sidebar h1 {
  font-size: 24px;
  font-weight: bold;
  color: #1DB954;
}

.sidebar a {
  color: #ddd;
  text-decoration: none;
  font-size: 16px;
  padding: 8px 0;
  transition: .2s;
}

.sidebar a:hover {
  color: white;
}

/* ------------------------- */
/*     MAIN CONTENT          */
/* ------------------------- */

.main {
  flex: 1;
  display: flex;
  flex-direction: column;
  background: linear-gradient(180deg, #222 0%, #000 40%);
  overflow: hidden;
}

.header {
  padding: 20px;
  font-size: 26px;
  font-weight: bold;
}

.search-box {
  margin: 0 20px;
}

.search-box input {
  width: 100%;
  padding: 14px;
  border-radius: 8px;
  background: #111;
  border: 1px solid #333;
  color: white;
  font-size: 16px;
}

/* ------------------------- */
/*       SEARCH RESULTS      */
/* ------------------------- */

.results {
  margin-top: 20px;
  padding: 0 20px;
  height: 260px;
  overflow-y: auto;
}

.result-item {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 12px;
  border-radius: 8px;
  margin-bottom: 8px;
  cursor: pointer;
  transition: .2s;
  background: #111;
}

.result-item:hover {
  background: #181818;
}

.result-item img {
  width: 65px;
  height: 65px;
  border-radius: 6px;
}

.result-title {
  font-size: 17px;
  font-weight: bold;
}

/* ------------------------- */
/*       PLAYLIST AREA       */
/* ------------------------- */

.playlist {
  padding: 20px;
  flex: 1;
  overflow-y: auto;
}

.playlist h2 {
  margin-bottom: 12px;
  font-size: 22px;
}

.song-item {
  background: #111;
  padding: 12px;
  border-radius: 8px;
  display: flex;
  gap: 15px;
  align-items: center;
  margin-bottom: 10px;
  cursor: pointer;
  transition: .2s;
}

.song-item:hover {
  background: #181818;
}

.song-item img {
  width: 60px;
  height: 60px;
  border-radius: 6px;
}

.song-info {
  display: flex;
  flex-direction: column;
}

.song-info .title {
  font-size: 16px;
  font-weight: bold;
}

.song-info .author {
  font-size: 14px;
  opacity: .7;
}

/* ------------------------- */
/*        PLAYER BAR         */
/* ------------------------- */

.player-bar {
  height: 110px;
  background: #111;
  border-top: 1px solid #222;
  display: flex;
  align-items: center;
  padding: 15px;
  gap: 20px;
}

.player-thumb {
  width: 75px;
  height: 75px;
  border-radius: 6px;
  background: #222;
}

.player-info {
  flex: 1;
}

.player-info .title {
  font-size: 18px;
  font-weight: bold;
}

.player-info .author {
  font-size: 14px;
  opacity: .7;
}

.controls {
  display: flex;
  gap: 20px;
}

.controls button {
  background: none;
  border: none;
  color: white;
  font-size: 28px;
  cursor: pointer;
}

.controls button:hover {
  color: #1DB954;
}

/* ------------------------- */
/* EMBED (GİZLİ PLAYER)      */
/* ------------------------- */

#yt-player {
  width: 0;
  height: 0;
  visibility: hidden;
}

/* ------------------------- */
/* SCROLL BAR                */
/* ------------------------- */

::-webkit-scrollbar {
  width: 6px;
}

::-webkit-scrollbar-thumb {
  background: #444;
  border-radius: 10px;
}

</style>
</head>
<body>

<!-- ----------------------------- -->
<!--          SIDEBAR              -->
<!-- ----------------------------- -->

<div class="sidebar">
  <h1>Kaptanify</h1>
  <a href="#">Ana Sayfa</a>
  <a href="#">Keşfet</a>
  <a href="#">Listem</a>
  <a href="#">Ayarlar</a>
</div>

<!-- ----------------------------- -->
<!--           MAIN                -->
<!-- ----------------------------- -->

<div class="main">

  <div class="header">Müzik Keşfet</div>

  <div class="search-box">
    <input id="searchInput" type="text" placeholder="Şarkı veya sanatçı ara…">
  </div>

  <div class="results" id="results"></div>

  <div class="playlist">
    <h2>Çalma Listem</h2>
    <div id="playlist"></div>
  </div>

</div>

<!-- ----------------------------- -->
<!--         PLAYER BAR            -->
<!-- ----------------------------- -->

<div class="player-bar">
  <img id="playerThumb" class="player-thumb" src="">
  <div class="player-info">
    <div class="title" id="playerTitle">Şarkı Seçilmedi</div>
    <div class="author" id="playerAuthor"></div>
  </div>

  <div class="controls">
    <button id="prevBtn">⏮</button>
    <button id="playBtn">▶</button>
    <button id="nextBtn">⏭</button>
  </div>
</div>

<!-- GİZLİ PLAYER -->
<iframe id="yt-player" src=""></iframe>

<!-- JS BURAYA GELECEK (PART 2) -->

</body>
</html>

<script>
// ==================== CONFIG =====================
const API_KEY = "AIzaSyAFmms_JJrVmmv-rPP4INamToX9xmuVyJY";
const MAX_RESULTS = 15;

// ==================== DOM ========================
const resultsEl = document.getElementById("results");
const playlistEl = document.getElementById("playlist");
const searchInput = document.getElementById("searchInput");

const playerThumb = document.getElementById("playerThumb");
const playerTitle = document.getElementById("playerTitle");
const playerAuthor = document.getElementById("playerAuthor");
const playBtn = document.getElementById("playBtn");
const prevBtn = document.getElementById("prevBtn");
const nextBtn = document.getElementById("nextBtn");

// ==================== STATE ========================
let searchResults = [];
let playlist = [];
let currentIndex = -1;
let ytPlayer = null;
let isPlaying = false;

// ==================== LOAD YT LIB ====================
let tag = document.createElement("script");
tag.src = "https://www.youtube.com/iframe_api";
document.body.appendChild(tag);

// YT Hazır olunca player kuruluyor
function onYouTubeIframeAPIReady() {
    ytPlayer = new YT.Player("yt-player", {
        height: "0",
        width: "0",
        videoId: "",
        playerVars: {
            autoplay: 0,
            controls: 0,
            modestbranding: 1,
            rel: 0,
            fs: 0,
            disablekb: 1,
            playsinline: 1,
            origin: window.location.origin
        },
        events: {
            onStateChange: playerState
        }
    });
}

function playerState(e) {
    if (e.data === YT.PlayerState.PLAYING) {
        isPlaying = true;
        playBtn.innerText = "⏸";
    }
    if (e.data === YT.PlayerState.PAUSED || e.data === YT.PlayerState.ENDED) {
        isPlaying = false;
        playBtn.innerText = "▶";
    }
    if (e.data === YT.PlayerState.ENDED) {
        nextTrack();
    }
}

// ==================== SEARCH ============================
async function searchYouTube(query) {
    if (!query) return [];

    let url = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&videoCategoryId=10&maxResults=${MAX_RESULTS}&key=${API_KEY}&q=${encodeURIComponent(query)}`;

    let res = await fetch(url);
    let data = await res.json();
    return data.items || [];
}

// ==================== RENDER RESULTS =====================
function renderResults(items) {
    resultsEl.innerHTML = "";
    searchResults = items;

    items.forEach((item, i) => {
        let vid = item.id.videoId;
        let title = item.snippet.title;
        let channel = item.snippet.channelTitle;
        let thumb = item.snippet.thumbnails.medium.url;

        let div = document.createElement("div");
        div.className = "result-item";
        div.dataset.index = i;

        div.innerHTML = `
            <img src="${thumb}">
            <div>
                <div class="result-title">${title}</div>
                <div class="channel">${channel}</div>
            </div>
            <button class="addBtn" style="background:#1DB954;border:none;padding:8px;border-radius:8px;cursor:pointer">+</button>
        `;

        // Şarkıya tıklayınca oynat
        div.addEventListener("click", e => {
            if (e.target.classList.contains("addBtn")) return; // + tuşu
            playFromResults(i);
        });

        // + tıklayınca playlist'e ekle
        div.querySelector(".addBtn").addEventListener("click", e => {
            e.stopPropagation();
            addToPlaylist({
                videoId: vid,
                title,
                thumb,
                channel
            });
        });

        resultsEl.appendChild(div);
    });
}

// ==================== SEARCH INPUT =======================
searchInput.addEventListener("input", async () => {
    let q = searchInput.value.trim();
    if (q.length === 0) {
        resultsEl.innerHTML = "";
        return;
    }

    let items = await searchYouTube(q);
    renderResults(items);
});

// ==================== PLAYLIST ===========================
function addToPlaylist(obj) {
    playlist.push(obj);
    renderPlaylist();
}

function renderPlaylist() {
    playlistEl.innerHTML = "";

    playlist.forEach((song, i) => {
        let d = document.createElement("div");
        d.className = "song-item";
        d.dataset.index = i;

        d.innerHTML = `
            <img src="${song.thumb}">
            <div class="song-info">
                <div class="title">${song.title}</div>
                <div class="author">${song.channel}</div>
            </div>
        `;

        d.addEventListener("click", () => playTrack(i));
        playlistEl.appendChild(d);
    });
}

// ==================== PLAYER ==============================
function playTrack(i) {
    currentIndex = i;
    let s = playlist[i];

    playerThumb.src = s.thumb;
    playerTitle.innerText = s.title;
    playerAuthor.innerText = s.channel;

    ytPlayer.loadVideoById(s.videoId);
    ytPlayer.playVideo();

    isPlaying = true;
    playBtn.innerText = "⏸";
}

function playFromResults(i) {
    let r = searchResults[i];
    addToPlaylist({
        videoId: r.id.videoId,
        title: r.snippet.title,
        thumb: r.snippet.thumbnails.medium.url,
        channel: r.snippet.channelTitle
    });

    playTrack(playlist.length - 1);
}

// ==================== CONTROLS ===========================
playBtn.addEventListener("click", () => {
    if (!ytPlayer) return;
    if (isPlaying) {
        ytPlayer.pauseVideo();
        playBtn.innerText = "▶";
    } else {
        ytPlayer.playVideo();
        playBtn.innerText = "⏸";
    }
});

prevBtn.addEventListener("click", prevTrack);
nextBtn.addEventListener("click", nextTrack);

function prevTrack() {
    if (currentIndex > 0) playTrack(currentIndex - 1);
}

function nextTrack() {
    if (currentIndex < playlist.length - 1) playTrack(currentIndex + 1);
}
</script>
