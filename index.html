<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kaptanın Spotify</title>

<style>

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: Arial, sans-serif;
}

body {
  background: #000;
  color: white;
  display: flex;
  height: 100vh;
  overflow: hidden;
}

/* ------------------------- */
/*        SIDEBAR            */
/* ------------------------- */

.sidebar {
  width: 240px;
  background: #000;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 25px;
  border-right: 1px solid #111;
}

.sidebar h1 {
  font-size: 24px;
  font-weight: bold;
  color: #1DB954;
}

.sidebar a {
  color: #ddd;
  text-decoration: none;
  font-size: 16px;
  padding: 8px 0;
  transition: .2s;
}

.sidebar a:hover {
  color: white;
}

/* ------------------------- */
/*     MAIN CONTENT          */
/* ------------------------- */

.main {
  flex: 1;
  display: flex;
  flex-direction: column;
  background: linear-gradient(180deg, #222 0%, #000 40%);
  overflow: hidden;
}

.header {
  padding: 20px;
  font-size: 26px;
  font-weight: bold;
}

.search-box {
  margin: 0 20px;
}

.search-box input {
  width: 100%;
  padding: 14px;
  border-radius: 8px;
  background: #111;
  border: 1px solid #333;
  color: white;
  font-size: 16px;
}

/* ------------------------- */
/*       SEARCH RESULTS      */
/* ------------------------- */

.results {
  margin-top: 20px;
  padding: 0 20px;
  height: 260px;
  overflow-y: auto;
}

.result-item {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 12px;
  border-radius: 8px;
  margin-bottom: 8px;
  cursor: pointer;
  transition: .2s;
  background: #111;
}

.result-item:hover {
  background: #181818;
}

.result-item img {
  width: 65px;
  height: 65px;
  border-radius: 6px;
}

.result-title {
  font-size: 17px;
  font-weight: bold;
}

/* ------------------------- */
/*       PLAYLIST AREA       */
/* ------------------------- */

.playlist {
  padding: 20px;
  flex: 1;
  overflow-y: auto;
}

.playlist h2 {
  margin-bottom: 12px;
  font-size: 22px;
}

.song-item {
  background: #111;
  padding: 12px;
  border-radius: 8px;
  display: flex;
  gap: 15px;
  align-items: center;
  margin-bottom: 10px;
  cursor: pointer;
  transition: .2s;
}

.song-item:hover {
  background: #181818;
}

.song-item img {
  width: 60px;
  height: 60px;
  border-radius: 6px;
}

.song-info {
  display: flex;
  flex-direction: column;
}

.song-info .title {
  font-size: 16px;
  font-weight: bold;
}

.song-info .author {
  font-size: 14px;
  opacity: .7;
}

/* ------------------------- */
/*        PLAYER BAR         */
/* ------------------------- */

.player-bar {
  height: 110px;
  background: #111;
  border-top: 1px solid #222;
  display: flex;
  align-items: center;
  padding: 15px;
  gap: 20px;
}

.player-thumb {
  width: 75px;
  height: 75px;
  border-radius: 6px;
  background: #222;
}

.player-info {
  flex: 1;
}

.player-info .title {
  font-size: 18px;
  font-weight: bold;
}

.player-info .author {
  font-size: 14px;
  opacity: .7;
}

.controls {
  display: flex;
  gap: 20px;
}

.controls button {
  background: none;
  border: none;
  color: white;
  font-size: 28px;
  cursor: pointer;
}

.controls button:hover {
  color: #1DB954;
}

/* ------------------------- */
/* EMBED (GİZLİ PLAYER)      */
/* ------------------------- */

#yt-player {
  width: 0;
  height: 0;
  visibility: hidden;
}

/* ------------------------- */
/* SCROLL BAR                */
/* ------------------------- */

::-webkit-scrollbar {
  width: 6px;
}

::-webkit-scrollbar-thumb {
  background: #444;
  border-radius: 10px;
}

</style>
</head>
<body>

<!-- ----------------------------- -->
<!--          SIDEBAR              -->
<!-- ----------------------------- -->

<div class="sidebar">
  <h1>Kaptanify</h1>
  <a href="#">Ana Sayfa</a>
  <a href="#">Keşfet</a>
  <a href="#">Listem</a>
  <a href="#">Ayarlar</a>
</div>

<!-- ----------------------------- -->
<!--           MAIN                -->
<!-- ----------------------------- -->

<div class="main">

  <div class="header">Müzik Keşfet</div>

  <div class="search-box">
    <input id="searchInput" type="text" placeholder="Şarkı veya sanatçı ara…">
  </div>

  <div class="results" id="results"></div>

  <div class="playlist">
    <h2>Çalma Listem</h2>
    <div id="playlist"></div>
  </div>

</div>

<!-- ----------------------------- -->
<!--         PLAYER BAR            -->
<!-- ----------------------------- -->

<div class="player-bar">
  <img id="playerThumb" class="player-thumb" src="">
  <div class="player-info">
    <div class="title" id="playerTitle">Şarkı Seçilmedi</div>
    <div class="author" id="playerAuthor"></div>
  </div>

  <div class="controls">
    <button id="prevBtn">⏮</button>
    <button id="playBtn">▶</button>
    <button id="nextBtn">⏭</button>
  </div>
</div>

<!-- GİZLİ PLAYER -->
<iframe id="yt-player" src=""></iframe>

<!-- JS BURAYA GELECEK (PART 2) -->

</body>
</html>

<script>

/* =============================
   KAPTAN — PART 2 (FULL FIXED)
   ============================= */

/* -------- CONFIG ---------- */
const API_KEY = "AIzaSyAFmms_JJrVmmv-rPP4INamToX9xmuVyJY";
const MAX_RESULTS = 15;

/* -------- DOM refs --------- */
const resultsEl = document.getElementById("results");
const playlistEl = document.getElementById("playlist");
const searchInput = document.getElementById("searchInput");
const playerThumb = document.getElementById("playerThumb");
const playerTitle = document.getElementById("playerTitle");
const playerAuthor = document.getElementById("playerAuthor");
const playBtn = document.getElementById("playBtn");
const prevBtn = document.getElementById("prevBtn");
const nextBtn = document.getElementById("nextBtn");

/* -------- state ---------- */
let ytPlayerMain = null;
let searchResults = [];
let playlist = [];
let currentIndex = -1;
let isPlaying = false;


/* ------------------------------------------
   YOUTUBE API YÜKLE
------------------------------------------ */
let tag = document.createElement("script");
tag.src = "https://www.youtube.com/iframe_api";
document.body.appendChild(tag);


/* ------------------------------------------
   API HAZIR → PLAYER OLUŞTUR
------------------------------------------ */
function onYouTubeIframeAPIReady() {
    ytPlayerMain = new YT.Player("yt-player", {
        height: "0",
        width: "0",
        playerVars: {
            autoplay: 0,
            controls: 0,
            disablekb: 1,
            rel: 0,
            modestbranding: 1,
            showinfo: 0,
            playsinline: 1,
            origin: window.location.origin
        },
        events: {
            onReady: () => console.log("YT Player Hazır!"),
            onStateChange: onMainStateChange
        }
    });
}


/* ------------------------------------------
   PLAYER STATE DEĞİŞİMİ
------------------------------------------ */
function onMainStateChange(e) {
    if (e.data === YT.PlayerState.PLAYING) {
        isPlaying = true;
        playBtn.innerText = "⏸";
    }
    if (e.data === YT.PlayerState.PAUSED) {
        isPlaying = false;
        playBtn.innerText = "▶";
    }
    if (e.data === YT.PlayerState.ENDED) {
        nextTrack();
    }
}


/* ------------------------------------------
   YOUTUBE SEARCH (API)
------------------------------------------ */
async function ytSearch(q) {
    if (!q.trim()) return [];

    let url =
        "https://www.googleapis.com/youtube/v3/search?" +
        new URLSearchParams({
            key: API_KEY,
            part: "snippet",
            q,
            maxResults: MAX_RESULTS,
            type: "video",
            videoCategoryId: "10"
        });

    let res = await fetch(url);
    if (!res.ok) return [];
    let data = await res.json();
    return data.items || [];
}


/* ------------------------------------------
   ARAMA SONUÇLARINI RENDER ET
------------------------------------------ */
function renderResults(list) {
    resultsEl.innerHTML = "";
    searchResults = list;

    list.forEach((it, i) => {
        const thumb = it.snippet.thumbnails.medium.url;
        const title = it.snippet.title;
        const ch = it.snippet.channelTitle;

        let el = document.createElement("div");
        el.className = "result-item";
        el.dataset.index = i;

        el.innerHTML = `
            <img src="${thumb}">
            <div style="flex:1">
                <div class="result-title">${title}</div>
                <div style="opacity:.7">${ch}</div>
            </div>
            <button class="plusBtn" style="background:#1DB954;border:none;padding:6px 10px;border-radius:6px;cursor:pointer">+</button>
        `;

        /* ► Tıkla & Oynat */
        el.addEventListener("click", (e) => {
            if (e.target.closest(".plusBtn")) return;
            playFromResults(i);
        });

        /* ➕ Playlist’e ekle */
        el.querySelector(".plusBtn").addEventListener("click", (e) => {
            e.stopPropagation();
            addToPlaylist({
                videoId: it.id.videoId,
                title,
                channel: ch,
                thumb
            });
        });

        resultsEl.appendChild(el);
    });
}


/* ------------------------------------------
   SONUÇTAN ŞARKI OYNAT
------------------------------------------ */
function playFromResults(index) {
    const item = searchResults[index];
    if (!item) return;

    const vid = item.id.videoId;

    playerThumb.src = item.snippet.thumbnails.medium.url;
    playerTitle.textContent = item.snippet.title;
    playerAuthor.textContent = item.snippet.channelTitle;

    ytPlayerMain.loadVideoById(vid);
    ytPlayerMain.playVideo();

    isPlaying = true;
    playBtn.innerText = "⏸";
}


/* ------------------------------------------
   PLAYLIST
------------------------------------------ */
function addToPlaylist(song) {
    playlist.push(song);
    renderPlaylist();
}

function renderPlaylist() {
    playlistEl.innerHTML = "";
    playlist.forEach((s, i) => {
        let el = document.createElement("div");
        el.className = "song-item";
        el.innerHTML = `
            <img src="${s.thumb}">
            <div class="song-info">
                <div class="title">${s.title}</div>
                <div class="author">${s.channel}</div>
            </div>
        `;

        el.addEventListener("click", () => playTrack(i));

        playlistEl.appendChild(el);
    });
}


/* ------------------------------------------
   PLAY A TRACK FROM PLAYLIST
------------------------------------------ */
function playTrack(i) {
    currentIndex = i;
    const s = playlist[i];
    if (!s) return;

    playerThumb.src = s.thumb;
    playerTitle.textContent = s.title;
    playerAuthor.textContent = s.channel;

    ytPlayerMain.loadVideoById(s.videoId);
    ytPlayerMain.playVideo();

    isPlaying = true;
    playBtn.innerText = "⏸";
}


/* ------------------------------------------
   NEXT / PREV
------------------------------------------ */
function nextTrack() {
    if (currentIndex < playlist.length - 1) {
        playTrack(currentIndex + 1);
    }
}

function prevTrack() {
    if (currentIndex > 0) {
        playTrack(currentIndex - 1);
    }
}


/* ------------------------------------------
   PLAY / PAUSE
------------------------------------------ */
playBtn.addEventListener("click", () => {
    if (!ytPlayerMain) return;

    if (isPlaying) {
        ytPlayerMain.pauseVideo();
        isPlaying = false;
        playBtn.innerText = "▶";
    } else {
        ytPlayerMain.playVideo();
        isPlaying = true;
        playBtn.innerText = "⏸";
    }
});


/* ------------------------------------------
   SEARCH (LIVE)
------------------------------------------ */
let searchTimeout;
searchInput.addEventListener("input", () => {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(async () => {
        let q = searchInput.value.trim();
        if (!q) {
            resultsEl.innerHTML = "";
            return;
        }
        let list = await ytSearch(q);
        renderResults(list);
    }, 300);
});


/* ------------------------------------------
   NEXT / PREV BUTTONS
------------------------------------------ */
nextBtn.addEventListener("click", nextTrack);
prevBtn.addEventListener("click", prevTrack);

</script>
</html>
